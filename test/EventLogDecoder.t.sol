// SPDX-License-Identifier: MIT
pragma solidity 0.8.19;

import {Test, console} from "forge-std/test.sol";
import {EventLogDecoder} from "../src/EventLogDecoder.sol";
import {ILogAutomation} from "../src/chainlink/ILogAutomation.sol";
import {EventUtils} from "gmx-synthetics/event/EventUtils.sol";

contract EventLogDecoderTest is Test {
    using EventLogDecoder for ILogAutomation.Log;
    using EventLogDecoder for EventUtils.EventLogData;

    function _realEventLog2Data() private view returns (ILogAutomation.Log memory log) {
        // REAL DATA FROM HERE: https://arbiscan.io/tx/0x04be86c99bc49a540eec1a936a17e975678da6fbd043e9b382cd3fe0cf33667e#eventlog
        bytes32[] memory topics = new bytes32[](4);
        topics[0] = 0x468a25a7ba624ceea6e540ad6f49171b52495b648417ae91bca21676d8a24dc5;
        topics[1] = 0xa7427759bfd3b941f14e687e129519da3c9b0046c5b9aaa290bb1dede63753b3;
        topics[2] = 0x464126dfccf7f941b1c81d99fa95f2cf7c27d88ec836f46de62dbf777a5bdab8;
        topics[3] = 0x000000000000000000000000542812580aae3d6d6793d5ea3427a26e3766dc77;
        log = ILogAutomation.Log({
            index: 1,
            txIndex: 2,
            txHash: bytes32("1"),
            blockNumber: block.number,
            blockHash: blockhash(block.number),
            source: address(1),
            topics: topics,
            data: hex"00000000000000000000000051e210dc8391728e2017b2ec050e40b2f458090e000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000c4f7264657243726561746564000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000005e00000000000000000000000000000000000000000000000000000000000000ca00000000000000000000000000000000000000000000000000000000000000d200000000000000000000000000000000000000000000000000000000000000f8000000000000000000000000000000000000000000000000000000000000010a0000000000000000000000000000000000000000000000000000000000000112000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000420000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000003400000000000000000000000000000000000000000000000000000000000000040000000000000000000000000542812580aae3d6d6793d5ea3427a26e3766dc7700000000000000000000000000000000000000000000000000000000000000076163636f756e74000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000542812580aae3d6d6793d5ea3427a26e3766dc770000000000000000000000000000000000000000000000000000000000000008726563656976657200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001063616c6c6261636b436f6e74726163740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d7569466565526563656976657200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000047c031236e19d024b42f8ae6780e44a57317070300000000000000000000000000000000000000000000000000000000000000066d61726b657400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000af88d065e77c8cc2239327c5edb3a432268e58310000000000000000000000000000000000000000000000000000000000000016696e697469616c436f6c6c61746572616c546f6b656e000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000873776170506174680000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000006a0000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000002c0000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000003c0000000000000000000000000000000000000000000000000000000000000044000000000000000000000000000000000000000000000000000000000000004c0000000000000000000000000000000000000000000000000000000000000054000000000000000000000000000000000000000000000000000000000000005c00000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000096f726465725479706500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000186465637265617365506f736974696f6e5377617054797065000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000010b19ce8080ab1b71b97799800000000000000000000000000000000000000000000000000000000000000000000c73697a6544656c7461557364000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000006755161000000000000000000000000000000000000000000000000000000000000001c696e697469616c436f6c6c61746572616c44656c7461416d6f756e74000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000efe1e38044253062000000000000000000000000000000000000000000000000000000000000000000000c74726967676572507269636500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000f247fcd0e8aaae4e800000000000000000000000000000000000000000000000000000000000000000000f61636365707461626c6550726963650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000023f4161d20800000000000000000000000000000000000000000000000000000000000000000c657865637574696f6e466565000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001063616c6c6261636b4761734c696d69740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f6d696e4f7574707574416d6f756e740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000071db8ec000000000000000000000000000000000000000000000000000000000000000e757064617465644174426c6f636b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000002400000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000669734c6f6e67000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001773686f756c64556e777261704e6174697665546f6b656e000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008697346726f7a656e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040464126dfccf7f941b1c81d99fa95f2cf7c27d88ec836f46de62dbf777a5bdab800000000000000000000000000000000000000000000000000000000000000036b65790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
        });
    }

    // Test decoding an event log 2
    function test_decodeEventLog2_realData() public {
        (address msgSender, string memory eventName,) =
            _realEventLog2Data().decodeEventLog2();

        assertEq(msgSender, 0x51e210dC8391728E2017B2Ec050e40b2f458090e);
        assertEq(eventName, "OrderCreated");
    }

    function test_decodeEventData_realData() public {
        (,, EventUtils.EventLogData memory eventData) = _realEventLog2Data().decodeEventLog2();
        (bytes32 key, address market, uint256 orderType, address[] memory swapPath) = eventData.decodeEventData();
        assertEq(key, 0x464126dfccf7f941b1c81d99fa95f2cf7c27d88ec836f46de62dbf777a5bdab8);
        assertEq(market, 0x47c031236e19d024b42f8AE6780E44A573170703);
        assertEq(orderType, 5);
        for (uint256 i = 0; i < swapPath.length; i++) {
            console.log(swapPath[i]);
        }
    }
}
